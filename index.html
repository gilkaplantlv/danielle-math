<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>משחק חשבון לדניאלי</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .game-wrapper {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            position: relative;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
        }

        h1 {
            color: #5f3dc4;
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .progress {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            font-size: clamp(1rem, 2vw, 1.2rem);
            color: #495057;
            flex-wrap: wrap;
        }

        .score-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }

        .lion-section {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            gap: 20px;
        }

        .lion {
            width: 80px;
            height: 80px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 120"><circle cx="50" cy="35" r="30" fill="%23ffb366"/><circle cx="50" cy="35" r="25" fill="%23ffa500"/><circle cx="20" cy="20" r="12" fill="%23ffb366"/><circle cx="80" cy="20" r="12" fill="%23ffb366"/><circle cx="42" cy="30" r="3" fill="%23333"/><circle cx="58" cy="30" r="3" fill="%23333"/><path d="M40 45 Q50 50 60 45" stroke="%23333" stroke-width="2" fill="none"/><ellipse cx="50" cy="75" rx="25" ry="35" fill="%23ffa500"/><rect x="30" y="90" width="10" height="25" rx="5" fill="%23ffb366"/><rect x="60" y="90" width="10" height="25" rx="5" fill="%23ffb366"/><rect x="25" y="60" width="10" height="20" rx="5" fill="%23ffb366"/><rect x="65" y="60" width="10" height="20" rx="5" fill="%23ffb366"/><path d="M15 100 Q25 105 25 115" stroke="%23ff8c42" stroke-width="3" fill="none"/><path d="M85 100 Q75 105 75 115" stroke="%23ff8c42" stroke-width="3" fill="none"/></svg>') no-repeat center;
            background-size: contain;
            animation: bounce 3s infinite;
            flex-shrink: 0;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .speech-bubble {
            background: white;
            border: 2px solid #5f3dc4;
            border-radius: 20px;
            padding: 12px 20px;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
            max-width: 300px;
        }

        .speech-bubble:before {
            content: '';
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            border-style: solid;
            border-width: 10px 10px 10px 0;
            border-color: transparent #5f3dc4 transparent transparent;
        }

        .question-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .question-type {
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            color: #5f3dc4;
            font-weight: bold;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .question {
            font-size: clamp(1.5rem, 4vw, 2.2rem);
            color: #212529;
            margin-bottom: 15px;
            line-height: 1.5;
            direction: ltr;
            text-align: center;
            font-weight: bold;
        }

        .word-problem {
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            color: #495057;
            margin-bottom: 20px;
            line-height: 1.6;
            text-align: right;
            direction: rtl;
            background: rgba(255,255,255,0.8);
            padding: 15px;
            border-radius: 10px;
        }

        .build-exercise {
            margin: 20px 0;
            padding: 20px;
            background: #f0f4ff;
            border-radius: 15px;
            border: 2px dashed #667eea;
        }

        .build-title {
            font-size: 1.1rem;
            color: #5f3dc4;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .draggable-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .draggable {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: grab;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .draggable:active {
            cursor: grabbing;
        }

        .draggable.dragging {
            opacity: 0.5;
            transform: scale(1.1);
        }

        .draggable:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .exercise-builder {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            min-height: 60px;
            direction: ltr;
        }

        .drop-zone {
            background: white;
            border: 3px dashed #dee2e6;
            border-radius: 10px;
            padding: 15px 25px;
            min-width: 80px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            background: #e8f5e9;
            border-color: #4caf50;
            transform: scale(1.05);
        }

        .drop-zone.filled {
            border-style: solid;
            border-color: #667eea;
            background: #f0f4ff;
        }

        .operator-zone {
            font-size: 1.5rem;
            color: #5f3dc4;
            font-weight: bold;
            padding: 0 15px;
        }

        .check-exercise-btn {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .check-exercise-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
        }

        .reset-exercise-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
            box-shadow: 0 3px 10px rgba(255, 107, 107, 0.3);
        }

        .reset-exercise-btn:hover {
            transform: translateY(-2px);
            background: #ff5252;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .visual-aid {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 120px;
        }

        .shape {
            stroke: #5f3dc4;
            stroke-width: 3;
            fill: rgba(95, 61, 196, 0.1);
        }

        .answers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .answer-btn {
            background: white;
            border: 3px solid #dee2e6;
            border-radius: 15px;
            padding: 18px;
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            border-color: #5f3dc4;
            background: #f8f9ff;
        }

        .answer-btn.selected {
            border-color: #28a745;
            background: #d4edda;
            animation: pulse 0.5s ease;
        }

        .answer-btn.wrong {
            border-color: #dc3545;
            background: #f8d7da;
            animation: shake 0.5s ease;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .help-section {
            text-align: center;
            margin-top: 20px;
        }

        .help-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-size: clamp(1rem, 2vw, 1.1rem);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .help-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .help-content {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            display: none;
            animation: slideDown 0.3s ease;
            text-align: right;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
        }

        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 500px; }
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding: 0 10px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            font-size: 1.5rem;
        }

        .nav-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            text-align: center;
            animation: popIn 0.5s ease;
            max-width: 90%;
            width: 400px;
        }

        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0); }
            to { transform: translate(-50%, -50%) scale(1); }
        }

        .feedback.correct {
            border: 3px solid #28a745;
        }

        .feedback.incorrect {
            border: 3px solid #ffc107;
        }

        .feedback h2 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: 10px;
        }

        .feedback.correct h2 {
            color: #28a745;
        }

        .feedback.incorrect h2 {
            color: #ffc107;
        }

        .feedback p {
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            color: #495057;
        }

        .summary {
            text-align: center;
            padding: 20px;
        }

        .summary h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 30px;
        }

        .final-score {
            font-size: clamp(3rem, 8vw, 4rem);
            color: #5f3dc4;
            margin: 20px 0;
            font-weight: bold;
        }

        .restart-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 15px 40px;
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        .multiplication-table {
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            gap: 2px;
            margin: 20px auto;
            max-width: 100%;
            overflow-x: auto;
            font-size: clamp(0.7rem, 1.5vw, 0.9rem);
        }

        .table-cell {
            padding: 5px;
            text-align: center;
            border: 1px solid #dee2e6;
            background: white;
            min-width: 30px;
        }

        .table-header {
            background: #5f3dc4;
            color: white;
            font-weight: bold;
        }

        .table-highlight {
            background: #ffd700 !important;
            font-weight: bold;
            color: #212529;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                border-radius: 15px;
            }
            
            .lion-section {
                flex-direction: column;
                gap: 10px;
            }
            
            .speech-bubble:before {
                display: none;
            }
            
            .answers {
                grid-template-columns: 1fr 1fr;
            }
            
            .help-content {
                font-size: 0.9rem;
            }
            
            .multiplication-table {
                font-size: 0.7rem;
            }
            
            .table-cell {
                padding: 3px;
                min-width: 25px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .answers {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .navigation {
                padding: 0;
            }
            
            .nav-btn {
                width: 45px;
                height: 45px;
            }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div class="container">
            <div class="header">
                <h1>משחק חשבון של דניאלי 🎮</h1>
                <div class="progress">
                    <span>שאלה <span id="currentQuestion">1</span> מתוך 25</span>
                    <span class="score-display">
                        ⭐ <span id="correctCount">0</span>
                    </span>
                </div>
            </div>

            <div class="lion-section">
                <div class="lion"></div>
                <div class="speech-bubble" id="lionMessage">בואי נתחיל!</div>
            </div>

            <div id="gameContent">
                <!-- Dynamic content will be inserted here -->
            </div>

            <div class="navigation">
                <button class="nav-btn" id="prevBtn" onclick="previousQuestion()">→</button>
                <button class="nav-btn" id="nextBtn" onclick="nextQuestion()">←</button>
            </div>
        </div>
    </div>

    <div class="feedback" id="feedback">
        <h2 id="feedbackTitle"></h2>
        <p id="feedbackMessage"></p>
    </div>

    <script>
        let currentQuestionIndex = 0;
        let questions = [];
        let score = 0;
        let answered = new Array(25).fill(false);
        let correctAnswers = new Array(25).fill(false);
        let attempts = new Array(25).fill(0);

        const lionMessages = [
            "את חכמה כל כך! 🌟",
            "אני כאן איתך! 💖",
            "תמשיכי ככה! 🌈",
            "את מיוחדת! ✨",
            "אני גאה בך! 🦁",
            "את נסיכה שלי! 👑",
            "יש לך כוח! 💪",
            "את מקסימה! 🌺",
            "המוח שלך עובד מצוין! 🧠",
            "את כוכבת! ⭐",
            "את יכולה הכל! 🚀",
            "אני מאמין בך! 🎯",
            "את נפלאה! 🎉",
            "המשיכי לחשוב! 🤔",
            "את מדהימה! 💝"
        ];

        function getRandomLionMessage() {
            return lionMessages[Math.floor(Math.random() * lionMessages.length)];
        }

        function generateQuestions() {
            questions = [];
            
            // Generate 3 addition questions (up to 100)
            for (let i = 0; i < 3; i++) {
                const a = Math.floor(Math.random() * 50) + 20;
                const b = Math.floor(Math.random() * 50) + 20;
                questions.push({
                    type: 'addition',
                    typeName: 'חיבור',
                    question: `${a} + ${b} = ?`,
                    answer: a + b,
                    help: `חיבור זה כמו לספור כמה יש לנו ביחד. אם יש לך ${a} סוכריות ועוד ${b} סוכריות, כמה סוכריות יש לך בסך הכל?`
                });
            }
            
            // Generate 2 subtraction questions (up to 100)
            for (let i = 0; i < 2; i++) {
                const a = Math.floor(Math.random() * 50) + 50;
                const b = Math.floor(Math.random() * a);
                questions.push({
                    type: 'subtraction',
                    typeName: 'חיסור',
                    question: `${a} - ${b} = ?`,
                    answer: a - b,
                    help: `חיסור זה כמו לקחת משהו. אם היו לך ${a} כוכבים ו-${b} נפלו, כמה כוכבים נשארו?`
                });
            }
            
            // Generate 3 multiplication questions
            const a1 = Math.floor(Math.random() * 4) + 2;
            const b1 = Math.floor(Math.random() * 4) + 2;
            questions.push({
                type: 'multiplication',
                typeName: 'כפל',
                question: `${a1} × ${b1} = ?`,
                answer: a1 * b1,
                multipliers: [a1, b1],
                help: `כפל זה כמו לקחת ${a1} קבוצות של ${b1}. למשל: ${a1} שקיות עם ${b1} ממתקים בכל שקית.`
            });
            
            for (let i = 0; i < 2; i++) {
                const a = Math.floor(Math.random() * 5) + 6;
                const b = Math.floor(Math.random() * 5) + 6;
                questions.push({
                    type: 'multiplication',
                    typeName: 'כפל',
                    question: `${a} × ${b} = ?`,
                    answer: a * b,
                    multipliers: [a, b],
                    help: `כפל זה כמו לקחת ${a} קבוצות של ${b}. למשל: ${a} שקיות עם ${b} ממתקים בכל שקית.`
                });
            }
            
            // Generate 4 division questions
            const easyDivisors = [2, 3, 4, 5];
            for (let i = 0; i < 2; i++) {
                const b = easyDivisors[Math.floor(Math.random() * easyDivisors.length)];
                const a = b * (Math.floor(Math.random() * 8) + 2);
                questions.push({
                    type: 'division',
                    typeName: 'חילוק',
                    question: `${a} ÷ ${b} = ?`,
                    answer: a / b,
                    divisors: [a, b],
                    multipliers: [b, a/b], // For multiplication table
                    help: `חילוק זה הפוך מכפל. ${a} ÷ ${b} = ? פירושו: איזה מספר כפול ${b} נותן ${a}? חפשי בלוח הכפל את ${b} × ? = ${a}`
                });
            }
            
            for (let i = 0; i < 2; i++) {
                const b = Math.floor(Math.random() * 4) + 6;
                const a = b * (Math.floor(Math.random() * 8) + 2);
                questions.push({
                    type: 'division',
                    typeName: 'חילוק',
                    question: `${a} ÷ ${b} = ?`,
                    answer: a / b,
                    divisors: [a, b],
                    multipliers: [b, a/b], // For multiplication table
                    help: `חילוק זה הפוך מכפל. ${a} ÷ ${b} = ? פירושו: איזה מספר כפול ${b} נותן ${a}? חפשי בלוח הכפל את ${b} × ? = ${a}`
                });
            }
            
            // Add word problems with variety
            const themes = {
                sweets: ['סוכריות', 'שוקולדים', 'עוגיות', 'ממתקים', 'מרשמלו', 'גומי דובים', 'סוכריות טופי'],
                toys: ['בובות', 'דובונים', 'כדורים', 'משחקים', 'פאזלים', 'קוביות', 'בלונים'],
                animals: ['גורי אריות', 'חתלתולים', 'גורי כלבים', 'ארנבונים', 'דובונים', 'פרפרים', 'דגי זהב'],
                nature: ['כוכבים', 'פרחים', 'עלים צבעוניים', 'צדפים', 'אבנים יפות', 'נוצות', 'פנינים'],
                art: ['מדבקות', 'ציורים', 'חרוזים', 'צבעים', 'נצנצים', 'כפתורים צבעוניים', 'חותמות'],
                fantasy: ['פיות קטנות', 'חדי קרן', 'דרקונים קטנים', 'קסמים', 'שרביטי קסם', 'כובעי קוסמים', 'ענני קסם']
            };
            
            const containers = ['קופסאות', 'שקיות', 'צנצנות', 'סלסלות', 'מגירות', 'כיסים', 'מדפים'];
            const friends = ['חברות', 'בנות הכיתה', 'הנסיכות', 'הפיות', 'בנות הצופים', 'חברות מהבלט'];
            
            // 1 addition/subtraction word problem
            const sweetItem = themes.sweets[Math.floor(Math.random() * themes.sweets.length)];
            const candies = Math.floor(Math.random() * 30) + 20;
            const eaten = Math.floor(Math.random() * 15) + 5;
            const receiver = friends[Math.floor(Math.random() * friends.length)];
            questions.push({
                type: 'word_problem',
                typeName: 'בעיה מילולית - חיבור וחיסור',
                wordProblem: `לדניאלי היו ${candies} ${sweetItem}. היא נתנה ${eaten} ל${receiver.slice(0, -2)} שלה, ואז קיבלה עוד 10 מאמא. כמה ${sweetItem} יש לדניאלי עכשיו?`,
                question: `${candies} - ${eaten} + 10 = ?`,
                answer: candies - eaten + 10,
                help: `נחשב צעד אחר צעד: ${candies} - ${eaten} = ${candies - eaten}, ואז ${candies - eaten} + 10 = ${candies - eaten + 10}`
            });
            
            // 2 multiplication word problems
            const container1 = containers[Math.floor(Math.random() * containers.length)];
            const item1 = themes.toys[Math.floor(Math.random() * themes.toys.length)];
            const boxes1 = Math.floor(Math.random() * 5) + 3;
            const items1 = Math.floor(Math.random() * 6) + 4;
            questions.push({
                type: 'word_problem',
                typeName: 'בעיה מילולית - כפל',
                wordProblem: `דניאלי אורזת ${item1} ל${container1}. יש לה ${boxes1} ${container1}, ובכל ${container1.slice(0, -2)} היא שמה ${items1} ${item1}. כמה ${item1} יש לה בסך הכל?`,
                question: `${boxes1} × ${items1} = ?`,
                answer: boxes1 * items1,
                multipliers: [boxes1, items1],
                help: `כפל: ${boxes1} ${container1} כפול ${items1} ${item1} בכל ${container1.slice(0, -2)}. חפשי בלוח הכפל!`
            });
            
            const artItem = themes.art[Math.floor(Math.random() * themes.art.length)];
            const rows = Math.floor(Math.random() * 4) + 4;
            const cols = Math.floor(Math.random() * 5) + 3;
            const places = ['באלבום', 'על הקיר', 'במחברת', 'על הלוח', 'בתערוכה'];
            const place = places[Math.floor(Math.random() * places.length)];
            questions.push({
                type: 'word_problem',
                typeName: 'בעיה מילולית - כפל',
                wordProblem: `דניאלי מסדרת ${artItem} ${place}. היא סידרה אותם ב-${rows} שורות ו-${cols} עמודות. כמה ${artItem} יש ${place}?`,
                question: `${rows} × ${cols} = ?`,
                answer: rows * cols,
                multipliers: [rows, cols],
                help: `נכפיל: ${rows} שורות כפול ${cols} עמודות. חפשי בלוח הכפל!`
            });
            
            // 2 division word problems
            const foodItem = themes.sweets[Math.floor(Math.random() * themes.sweets.length)];
            const friendGroup1 = friends[Math.floor(Math.random() * friends.length)];
            const totalCookies = Math.floor(Math.random() * 5 + 4) * 6;
            const friends1 = 6;
            questions.push({
                type: 'word_problem',
                typeName: 'בעיה מילולית - חילוק',
                wordProblem: `דניאלי הכינה ${totalCookies} ${foodItem} והיא רוצה לחלק אותם שווה בשווה בין ${friends1} ${friendGroup1}. כמה ${foodItem} תקבל כל אחת?`,
                question: `${totalCookies} ÷ ${friends1} = ?`,
                answer: totalCookies / friends1,
                multipliers: [friends1, totalCookies / friends1],
                help: `חילוק הוא הפוך מכפל. חפשי בלוח הכפל: ${friends1} × ? = ${totalCookies}`
            });
            
            const activities = ['עמודים בספר קסמים', 'תרגילי בלט', 'ציורי חדי קרן', 'שירים', 'חידות'];
            const activity = activities[Math.floor(Math.random() * activities.length)];
            const totalPages = Math.floor(Math.random() * 8 + 5) * 7;
            const daysInWeek = 7;
            questions.push({
                type: 'word_problem',
                typeName: 'בעיה מילולית - חילוק',
                wordProblem: `דניאלי רוצה להשלים ${totalPages} ${activity} בדיוק בשבוע (7 ימים). כמה ${activity} היא צריכה לעשות כל יום?`,
                question: `${totalPages} ÷ ${daysInWeek} = ?`,
                answer: totalPages / daysInWeek,
                multipliers: [daysInWeek, totalPages / daysInWeek],
                help: `חילוק הוא הפוך מכפל. חפשי בלוח הכפל: ${daysInWeek} × ? = ${totalPages}`
            });
            
            // Continue with inequality questions
            for (let i = 0; i < 6; i++) {
                let expr1, expr2, val1, val2;
                
                if (i < 2) {
                    const divisor = Math.floor(Math.random() * 5) + 2;
                    const dividend = divisor * (Math.floor(Math.random() * 8) + 3);
                    const b = Math.floor(Math.random() * 30) + 10;
                    expr1 = `${dividend} ÷ ${divisor}`;
                    val1 = dividend / divisor;
                    
                    if (i === 0) {
                        expr2 = `${b}`;
                        val2 = b;
                    } else {
                        const c = Math.floor(Math.random() * 15) + 5;
                        const d = Math.floor(Math.random() * 15) + 5;
                        expr2 = `${c} + ${d}`;
                        val2 = c + d;
                    }
                } else if (i < 4) {
                    const divisor1 = Math.floor(Math.random() * 6) + 3;
                    const dividend1 = divisor1 * (Math.floor(Math.random() * 7) + 4);
                    expr1 = `${dividend1} ÷ ${divisor1}`;
                    val1 = dividend1 / divisor1;
                    
                    if (i === 2) {
                        const a = Math.floor(Math.random() * 6) + 2;
                        const b = Math.floor(Math.random() * 6) + 2;
                        expr2 = `${a} × ${b}`;
                        val2 = a * b;
                    } else {
                        const c = Math.floor(Math.random() * 50) + 30;
                        const d = Math.floor(Math.random() * 20) + 10;
                        expr2 = `${c} - ${d}`;
                        val2 = c - d;
                    }
                } else {
                    const divisor1 = Math.floor(Math.random() * 5) + 2;
                    const dividend1 = divisor1 * (Math.floor(Math.random() * 10) + 5);
                    const divisor2 = Math.floor(Math.random() * 4) + 2;
                    const dividend2 = divisor2 * (Math.floor(Math.random() * 8) + 3);
                    
                    if (i === 4) {
                        expr1 = `${dividend1} ÷ ${divisor1}`;
                        expr2 = `${dividend2} ÷ ${divisor2}`;
                        val1 = dividend1 / divisor1;
                        val2 = dividend2 / divisor2;
                    } else {
                        const add = Math.floor(Math.random() * 20) + 10;
                        expr1 = `${dividend1} ÷ ${divisor1} + ${add}`;
                        expr2 = `${dividend2} ÷ ${divisor2}`;
                        val1 = (dividend1 / divisor1) + add;
                        val2 = dividend2 / divisor2;
                    }
                }
                
                const operator = val1 > val2 ? '<' : (val1 < val2 ? '>' : '=');
                questions.push({
                    type: 'inequality',
                    typeName: 'השוואה',
                    question: `${expr1} ___ ${expr2}`,
                    answer: operator,
                    help: `קודם נחשב כל צד: ${expr1} = ${val1}, ${expr2} = ${val2}. עכשיו נשווה: ${val1} ${val1 > val2 ? '>' : (val1 < val2 ? '<' : '=')} ${val2}`
                });
            }
            
            // Generate 2 geometry questions
            const shapes = [
                { name: 'ריבוע', sides: 4, formula: 'side', calcPerimeter: (s) => 4 * s, calcArea: (s) => s * s },
                { name: 'מלבן', sides: 4, formula: 'length,width', calcPerimeter: (l, w) => 2 * (l + w), calcArea: (l, w) => l * w },
                { name: 'משולש שווה צלעות', sides: 3, formula: 'side', calcPerimeter: (s) => 3 * s }
            ];
            
            for (let i = 0; i < 2; i++) {
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                const isPerimeter = i === 0 || !shape.calcArea;
                
                if (shape.formula === 'side') {
                    const side = Math.floor(Math.random() * 8) + 3;
                    questions.push({
                        type: 'geometry',
                        typeName: 'גיאומטריה',
                        shape: shape.name,
                        sides: shape.sides,
                        measurements: { side },
                        question: isPerimeter ? `היקף ${shape.name} = ?` : `שטח ${shape.name} = ?`,
                        description: isPerimeter ? `חשבי את ההיקף של ${shape.name} עם צלע ${side} ס"מ` : `חשבי את השטח של ${shape.name} עם צלע ${side} ס"מ`,
                        answer: isPerimeter ? shape.calcPerimeter(side) : shape.calcArea(side),
                        unit: isPerimeter ? 'ס"מ' : 'סמ"ר',
                        help: isPerimeter ? `היקף זה הקו מסביב לצורה. ב${shape.name} יש ${shape.sides} צלעות שוות.` : `שטח זה כמה מקום תופסת הצורה.`
                    });
                } else {
                    const length = Math.floor(Math.random() * 6) + 4;
                    const width = Math.floor(Math.random() * 6) + 3;
                    questions.push({
                        type: 'geometry',
                        typeName: 'גיאומטריה',
                        shape: shape.name,
                        sides: shape.sides,
                        measurements: { length, width },
                        question: isPerimeter ? `היקף ${shape.name} = ?` : `שטח ${shape.name} = ?`,
                        description: isPerimeter ? `חשבי את ההיקף של ${shape.name} עם אורך ${length} ס"מ ורוחב ${width} ס"מ` : `חשבי את השטח של ${shape.name} עם אורך ${length} ס"מ ורוחב ${width} ס"מ`,
                        answer: isPerimeter ? shape.calcPerimeter(length, width) : shape.calcArea(length, width),
                        unit: isPerimeter ? 'ס"מ' : 'סמ"ר',
                        help: isPerimeter ? `היקף של מלבן = 2 × (אורך + רוחב)` : `שטח של מלבן = אורך × רוחב`
                    });
                }
            }
            
            // Shuffle questions
            questions.sort(() => Math.random() - 0.5);
        }

        function generateWrongAnswers(correctAnswer, type) {
            const wrongAnswers = [];
            const variations = [-10, -5, -2, -1, 1, 2, 5, 10];
            
            if (type === 'inequality') {
                const options = ['>', '<', '='];
                return options.filter(op => op !== correctAnswer);
            }
            
            while (wrongAnswers.length < 3) {
                let wrong;
                if (type === 'multiplication' || type === 'division') {
                    wrong = correctAnswer + variations[Math.floor(Math.random() * variations.length)];
                } else {
                    const offset = Math.floor(Math.random() * 20) - 10;
                    wrong = correctAnswer + offset;
                }
                
                if (wrong > 0 && wrong !== correctAnswer && !wrongAnswers.includes(wrong)) {
                    wrongAnswers.push(wrong);
                }
            }
            
            return wrongAnswers;
        }

        function displayQuestion() {
            const q = questions[currentQuestionIndex];
            const answers = [q.answer, ...generateWrongAnswers(q.answer, q.type)].sort(() => Math.random() - 0.5);
            
            let visualAid = '';
            if (q.type === 'geometry') {
                visualAid = generateShapeVisual(q);
            }
            
            let html = `
                <div class="question-container">
                    <div class="question-type">${q.typeName}</div>
                    ${q.wordProblem ? `<div class="word-problem">${q.wordProblem}</div>` : ''}
            `;
            
            // For word problems, add drag and drop interface
            if (q.wordProblem) {
                const numbers = extractNumbersFromProblem(q);
                const operatorInfo = getOperatorInfo(q);
                
                html += `
                    <div class="build-exercise">
                        <div class="build-title">🎯 בני את התרגיל מהמספרים בבעיה:</div>
                        <div class="draggable-container">
                            ${numbers.map((num, idx) => 
                                `<div class="draggable" draggable="true" data-value="${num}" data-id="num${idx}">${num}</div>`
                            ).join('')}
                        </div>
                        <div class="exercise-builder">
                `;
                
                // Build the exercise template based on operation type
                if (operatorInfo.operators.length === 1) {
                    // Simple operation (×, ÷, single + or -)
                    html += `
                        <div class="drop-zone" data-position="first"></div>
                        <div class="operator-zone">${operatorInfo.operators[0]}</div>
                        <div class="drop-zone" data-position="second"></div>
                    `;
                } else {
                    // Complex operation (multiple operators)
                    html += `
                        <div class="drop-zone" data-position="first"></div>
                        <div class="operator-zone">${operatorInfo.operators[0]}</div>
                        <div class="drop-zone" data-position="second"></div>
                        <div class="operator-zone">${operatorInfo.operators[1]}</div>
                        <div class="drop-zone" data-position="third"></div>
                    `;
                }
                
                html += `
                            <div class="operator-zone">=</div>
                            <div class="operator-zone">?</div>
                        </div>
                        <button class="check-exercise-btn" onclick="checkExerciseBuilder()" disabled>בדקי את התרגיל</button>
                        <button class="reset-exercise-btn" onclick="resetExercise()" style="display:none;">🔄 אפסי את התרגיל</button>
                    </div>
                    <div id="exerciseResult" style="display:none;">
                        <div class="question">${q.question}</div>
                `;
            } else {
                html += `<div class="question">${q.question}</div>`;
            }
            
            html += `
                    ${q.description ? `<div class="description">${q.description}</div>` : ''}
                    ${visualAid}
                    <div class="help-section">
                        <button class="help-btn" onclick="toggleHelp()">💡 עזרה</button>
                        <div class="help-content" id="helpContent">
                            <p>${q.help}</p>
                            ${(q.type === 'multiplication' || q.type === 'division' || (q.type === 'word_problem' && q.multipliers)) ? generateMultiplicationTable(q.multipliers) : ''}
                        </div>
                    </div>
                </div>
                <div class="answers" id="answersSection" ${q.wordProblem ? 'style="display:none;"' : ''}>
            `;
            
            answers.forEach((answer, index) => {
                const displayAnswer = q.type === 'geometry' ? `${answer} ${q.unit}` : answer;
                html += `<button class="answer-btn" onclick="checkAnswer(${q.type === 'inequality' ? `'${answer}'` : answer}, this)">${displayAnswer}</button>`;
            });
            
            html += '</div>';
            
            document.getElementById('gameContent').innerHTML = html;
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('lionMessage').textContent = getRandomLionMessage();
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').disabled = !answered[currentQuestionIndex];
            
            // Initialize drag and drop if it's a word problem
            if (q.wordProblem) {
                initializeDragAndDrop();
            }
        }

        function extractNumbersFromProblem(question) {
            if (question.question.includes('+') && question.question.includes('-')) {
                // For add/subtract problems
                const match = question.question.match(/(\d+)\s*-\s*(\d+)\s*\+\s*(\d+)/);
                if (match) return [match[1], match[2], match[3]];
            } else {
                // For simple operations
                const match = question.question.match(/(\d+)\s*[×÷+-]\s*(\d+)/);
                if (match) return [match[1], match[2]];
            }
            return [];
        }

        function getOperatorInfo(question) {
            const questionText = question.question;
            if (questionText.includes('+') && questionText.includes('-')) {
                // Complex operation with multiple operators
                const match = questionText.match(/(\d+)\s*-\s*(\d+)\s*\+\s*(\d+)/);
                if (match) return { operators: ['-', '+'], count: 3 };
            } else if (questionText.includes('×')) {
                return { operators: ['×'], count: 2 };
            } else if (questionText.includes('÷')) {
                return { operators: ['÷'], count: 2 };
            } else if (questionText.includes('+')) {
                return { operators: ['+'], count: 2 };
            } else if (questionText.includes('-')) {
                return { operators: ['-'], count: 2 };
            }
            return { operators: [], count: 0 };
        }

        function initializeDragAndDrop() {
            const draggables = document.querySelectorAll('.draggable');
            const dropZones = document.querySelectorAll('.drop-zone');
            
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', dragStart);
                draggable.addEventListener('dragend', dragEnd);
            });
            
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', dragOver);
                zone.addEventListener('drop', dragDrop);
                zone.addEventListener('dragleave', dragLeave);
            });
        }

        let draggedElement = null;

        function dragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
        }

        function dragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function dragOver(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }

        function dragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        function dragDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            if (draggedElement) {
                // If zone already has a number, swap them
                if (e.target.textContent.trim() !== '') {
                    // Return existing number to container
                    const existingValue = e.target.textContent;
                    const container = document.querySelector('.draggable-container');
                    const newDraggable = document.createElement('div');
                    newDraggable.className = 'draggable';
                    newDraggable.draggable = true;
                    newDraggable.textContent = existingValue;
                    newDraggable.setAttribute('data-value', existingValue);
                    newDraggable.addEventListener('dragstart', dragStart);
                    newDraggable.addEventListener('dragend', dragEnd);
                    container.appendChild(newDraggable);
                }
                
                e.target.textContent = draggedElement.getAttribute('data-value');
                e.target.classList.add('filled');
                draggedElement.remove();
                
                // Check if all zones are filled
                const allZones = document.querySelectorAll('.drop-zone');
                const filledZones = document.querySelectorAll('.drop-zone.filled');
                if (filledZones.length === allZones.length) {
                    document.querySelector('.check-exercise-btn').disabled = false;
                }
            }
        }

        function checkExerciseBuilder() {
            const q = questions[currentQuestionIndex];
            const operatorInfo = getOperatorInfo(q);
            const zones = document.querySelectorAll('.drop-zone');
            
            let isCorrect = false;
            
            if (operatorInfo.count === 3) {
                // Complex operation with 3 numbers
                const firstValue = parseInt(zones[0].textContent);
                const secondValue = parseInt(zones[1].textContent);
                const thirdValue = parseInt(zones[2].textContent);
                
                // For the specific pattern: X - Y + Z
                const match = q.question.match(/(\d+)\s*-\s*(\d+)\s*\+\s*(\d+)/);
                const expectedFirst = parseInt(match[1]);
                const expectedSecond = parseInt(match[2]);
                const expectedThird = parseInt(match[3]);
                
                isCorrect = firstValue === expectedFirst && 
                           secondValue === expectedSecond && 
                           thirdValue === expectedThird;
            } else {
                // Simple operation with 2 numbers
                const firstValue = parseInt(zones[0].textContent);
                const secondValue = parseInt(zones[1].textContent);
                
                const match = q.question.match(/(\d+)\s*[×÷+-]\s*(\d+)/);
                const expectedFirst = parseInt(match[1]);
                const expectedSecond = parseInt(match[2]);
                
                const operator = operatorInfo.operators[0];
                
                // For addition and multiplication, order doesn't matter
                if (operator === '+' || operator === '×') {
                    isCorrect = (firstValue === expectedFirst && secondValue === expectedSecond) ||
                               (firstValue === expectedSecond && secondValue === expectedFirst);
                } else {
                    // For subtraction and division, order matters
                    isCorrect = firstValue === expectedFirst && secondValue === expectedSecond;
                }
            }
            
            if (isCorrect) {
                // Correct exercise built
                zones.forEach(zone => {
                    zone.style.borderColor = '#4caf50';
                    zone.style.background = '#e8f5e9';
                });
                
                setTimeout(() => {
                    document.getElementById('exerciseResult').style.display = 'block';
                    document.getElementById('answersSection').style.display = 'grid';
                    document.querySelector('.build-exercise').style.display = 'none';
                }, 1000);
            } else {
                // Wrong exercise
                zones.forEach(zone => {
                    zone.style.borderColor = '#dc3545';
                    zone.style.background = '#f8d7da';
                });
                
                // Show reset button
                document.querySelector('.reset-exercise-btn').style.display = 'inline-block';
                
                setTimeout(() => {
                    zones.forEach(zone => {
                        zone.style.borderColor = '#667eea';
                        zone.style.background = '#f0f4ff';
                    });
                }, 1000);
            }
        }

        function resetExercise() {
            const q = questions[currentQuestionIndex];
            const numbers = extractNumbersFromProblem(q);
            const dropZones = document.querySelectorAll('.drop-zone');
            const container = document.querySelector('.draggable-container');
            
            // Clear drop zones
            dropZones.forEach(zone => {
                zone.textContent = '';
                zone.classList.remove('filled');
                zone.style.borderColor = '#dee2e6';
                zone.style.background = 'white';
            });
            
            // Clear existing draggables
            container.innerHTML = '';
            
            // Recreate draggables
            numbers.forEach((num, idx) => {
                const draggable = document.createElement('div');
                draggable.className = 'draggable';
                draggable.draggable = true;
                draggable.setAttribute('data-value', num);
                draggable.setAttribute('data-id', `num${idx}`);
                draggable.textContent = num;
                draggable.addEventListener('dragstart', dragStart);
                draggable.addEventListener('dragend', dragEnd);
                container.appendChild(draggable);
            });
            
            // Disable check button and hide reset button
            document.querySelector('.check-exercise-btn').disabled = true;
            document.querySelector('.reset-exercise-btn').style.display = 'none';
        }

        function generateShapeVisual(q) {
            let svg = '<div class="visual-aid"><svg width="200" height="150" viewBox="0 0 200 150">';
            
            switch(q.shape) {
                case 'ריבוע':
                    svg += '<rect x="50" y="25" width="100" height="100" class="shape"/>';
                    svg += '<text x="100" y="140" text-anchor="middle" font-size="14">' + q.measurements.side + ' ס"מ</text>';
                    break;
                case 'מלבן':
                    svg += '<rect x="40" y="35" width="120" height="80" class="shape"/>';
                    svg += '<text x="100" y="130" text-anchor="middle" font-size="14">' + q.measurements.length + ' ס"מ</text>';
                    svg += '<text x="25" y="75" text-anchor="middle" font-size="14">' + q.measurements.width + ' ס"מ</text>';
                    break;
                case 'משולש שווה צלעות':
                    svg += '<polygon points="100,20 50,110 150,110" class="shape"/>';
                    svg += '<text x="100" y="130" text-anchor="middle" font-size="14">' + q.measurements.side + ' ס"מ</text>';
                    break;
            }
            
            svg += '</svg></div>';
            return svg;
        }

        function generateMultiplicationTable(multipliers) {
            if (!multipliers) return '';
            
            const [a, b] = multipliers;
            let table = '<div class="multiplication-table">';
            
            // Header row
            table += '<div class="table-cell table-header">×</div>';
            for (let i = 1; i <= 10; i++) {
                table += `<div class="table-cell table-header">${i}</div>`;
            }
            
            // Table rows
            for (let i = 1; i <= 10; i++) {
                table += `<div class="table-cell table-header">${i}</div>`;
                for (let j = 1; j <= 10; j++) {
                    const isHighlight = (i === a && j === b) || (i === b && j === a);
                    table += `<div class="table-cell ${isHighlight ? 'table-highlight' : ''}">${i * j}</div>`;
                }
            }
            
            table += '</div>';
            return table;
        }

        function toggleHelp() {
            const helpContent = document.getElementById('helpContent');
            helpContent.style.display = helpContent.style.display === 'none' ? 'block' : 'none';
        }

        function checkAnswer(answer, button) {
            if (answered[currentQuestionIndex]) return;
            
            const q = questions[currentQuestionIndex];
            let isCorrect;
            
            if (q.type === 'inequality') {
                const buttonText = button.textContent.trim();
                const answerMap = {
                    '>': '>',
                    '<': '<', 
                    '=': '='
                };
                isCorrect = answerMap[buttonText] === q.answer;
            } else {
                isCorrect = answer === q.answer;
            }
            
            attempts[currentQuestionIndex]++;
            
            if (isCorrect) {
                answered[currentQuestionIndex] = true;
                correctAnswers[currentQuestionIndex] = true;
                if (attempts[currentQuestionIndex] === 1) {
                    score++;
                    updateScore();
                }
                button.classList.add('selected');
                showFeedback(true, attempts[currentQuestionIndex] === 1);
                document.getElementById('nextBtn').disabled = false;
                document.querySelectorAll('.answer-btn').forEach(btn => {
                    btn.style.pointerEvents = 'none';
                });
            } else {
                button.classList.add('wrong');
                button.style.pointerEvents = 'none';
                showFeedback(false, false);
                if (attempts[currentQuestionIndex] >= 3) {
                    answered[currentQuestionIndex] = true;
                    document.getElementById('nextBtn').disabled = false;
                    document.querySelectorAll('.answer-btn').forEach(btn => {
                        if (q.type === 'inequality') {
                            const btnText = btn.textContent.trim();
                            if (btnText === q.answer) {
                                btn.classList.add('selected');
                                btn.style.border = '3px solid #28a745';
                                btn.style.background = '#d4edda';
                            }
                        } else {
                            const btnValue = btn.textContent.replace(/[^\d<>=.-]/g, '');
                            if ((q.type === 'geometry' && parseInt(btnValue) === q.answer) ||
                                (q.type !== 'geometry' && parseFloat(btnValue) === q.answer)) {
                                btn.classList.add('selected');
                                btn.style.border = '3px solid #28a745';
                                btn.style.background = '#d4edda';
                            }
                        }
                        btn.style.pointerEvents = 'none';
                    });
                    showFeedback(false, true);
                }
            }
        }

        function showFeedback(isCorrect, firstAttempt) {
            const feedback = document.getElementById('feedback');
            const title = document.getElementById('feedbackTitle');
            const message = document.getElementById('feedbackMessage');
            
            feedback.className = isCorrect ? 'feedback correct' : 'feedback incorrect';
            
            if (isCorrect) {
                title.textContent = '🎉 מצוין!';
                const messages = firstAttempt ? [
                    'דניאלי, את אלופה אמיתית! 🌟',
                    'וואו דניאלי! תשובה מושלמת! 🎯',
                    'דניאלי, יש לך מוח של גאון! 🧠',
                    'כל הכבוד דניאלי! את מדהימה! 💝',
                    'דניאלי את נסיכת המתמטיקה! 👑'
                ] : [
                    'יופי דניאלי! הצלחת! 🌟',
                    'כל הכבוד שלא ויתרת דניאלי! 💪',
                    'מעולה דניאלי! ידעתי שתצליחי! 🎯'
                ];
                message.textContent = messages[Math.floor(Math.random() * messages.length)];
            } else {
                if (firstAttempt) {
                    title.textContent = '😊 הנה התשובה הנכונה';
                    message.textContent = 'דניאלי, בואי נמשיך לשאלה הבאה! את מתקדמת מצוין! 🌈';
                } else {
                    title.textContent = '💪 נסי שוב!';
                    const messages = [
                        'דניאלי, את קרובה! נסי עוד פעם! 🌟',
                        'כמעט דניאלי! בואי ננסה שוב! 💖',
                        'דניאלי, אני מאמין בך! עוד ניסיון! 🚀',
                        'את בכיוון הנכון דניאלי! המשיכי! 🌈'
                    ];
                    message.textContent = messages[Math.floor(Math.random() * messages.length)];
                }
            }
            
            feedback.style.display = 'block';
            setTimeout(() => {
                feedback.style.display = 'none';
            }, 2500);
        }

        function updateScore() {
            document.getElementById('correctCount').textContent = score;
        }

        function nextQuestion() {
            if (currentQuestionIndex < 24) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                showSummary();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function showSummary() {
            let grade = '';
            const percentage = (score / 25) * 100;
            
            if (percentage === 100) grade = 'פשוט מושלמת! את גאון על! 🏆🌟';
            else if (percentage >= 90) grade = 'מדהימה! את גאון אמיתי! 🏆';
            else if (percentage >= 70) grade = 'מצוין! את אלופה! 🌟';
            else if (percentage >= 50) grade = 'יפה מאוד! המשיכי להתאמן! 💪';
            else grade = 'כל הכבוד על המאמץ! 💝';
            
            const starCount = Math.ceil((score / 25) * 5);
            let starsDisplay = '';
            for (let i = 0; i < starCount; i++) {
                starsDisplay += '⭐';
            }
            
            const html = `
                <div class="summary">
                    <h1>🎊 המשחק הסתיים! 🎊</h1>
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 20px; padding: 30px; margin: 20px 0;">
                        <h2 style="font-size: 1.8rem; color: #333; margin-bottom: 15px;">התוצאה הסופית:</h2>
                        <div class="final-score">${score}/25</div>
                        <p style="font-size: 1.3rem; font-weight: bold; color: #495057;">דניאלי ענתה נכון על ${score} שאלות מתוך 25!</p>
                    </div>
                    <p style="font-size: 1.4rem; margin: 20px 0; color: #5f3dc4;">${grade}</p>
                    <div style="font-size: 3rem; margin: 30px 0;">
                        ${starsDisplay}
                    </div>
                    <button class="restart-btn" onclick="restartGame()">🎮 בואי נשחק שוב!</button>
                </div>
            `;
            
            document.getElementById('gameContent').innerHTML = html;
            document.querySelector('.navigation').style.display = 'none';
            document.getElementById('lionMessage').textContent = 'את אלופה דניאלי! 🏆';
        }

        function restartGame() {
            currentQuestionIndex = 0;
            score = 0;
            answered = new Array(25).fill(false);
            correctAnswers = new Array(25).fill(false);
            attempts = new Array(25).fill(0);
            generateQuestions();
            displayQuestion();
            document.querySelector('.navigation').style.display = 'flex';
            updateScore();
        }

        // Initialize game
        generateQuestions();
        displayQuestion();
        updateScore();
    </script>
</body>
</html>
